<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Agreement - Arajit Halder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- WEB VIEW STYLES (ডার্ক থিম এবং মডার্ন লুক) --- */
        :root { --primary-red: #D20020; --sidebar-bg: #111; --bg-light: #f4f7f6; }
        * { box-sizing: border-box; }
        body { margin: 0; padding: 40px; background: var(--bg-light); font-family: 'Poppins', sans-serif; display: flex; justify-content: center; }

        .web-container {
            display: flex; width: 100%; max-width: 1200px; background: white;
            border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.1); min-height: 800px;
        }

        .info-panel { flex: 0.8; background: var(--sidebar-bg); color: white; padding: 60px; position: relative; }
        .back-arrow { color: white; font-size: 1.2rem; position: absolute; top: 40px; left: 40px; border: 1px solid rgba(255,255,255,0.2); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; text-decoration: none; }
        .info-panel h1 { font-size: 3rem; margin-top: 60px; line-height: 1.1; }
        .info-panel h1 span { color: var(--primary-red); }
        .feature-list li { margin-bottom: 20px; display: flex; gap: 15px; align-items: center; }
        .feature-list i { color: var(--primary-red); }

        .form-panel { flex: 1.2; padding: 60px; background: white; }
        .section-heading { font-weight: 700; font-size: 1.1rem; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 25px; display: block; }
        .form-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .form-group { flex: 1; }
        .form-group label { font-size: 0.8rem; font-weight: 700; color: #555; display: block; margin-bottom: 5px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; background: #f9f9f9; }
        textarea.form-input { height: 100px; resize: vertical; }
        
        .upload-container { border: 2px dashed #ccc; padding: 30px; text-align: center; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .upload-container:hover { border-color: var(--primary-red); background: #fff5f5; }
        .file-preview img { max-height: 60px; margin-top: 10px; display: none; }

        .submit-btn { width: 100%; background: var(--primary-red); color: white; padding: 18px; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; margin-top: 20px; font-size: 1rem; }
        .submit-btn:hover { background: #a00018; }

        /* --- PDF TEMPLATE STYLES (অফিসিয়াল ডকুমেন্ট ডিজাইন) --- */
        /* এই অংশটি স্ক্রিনের মাঝখানে প্রিভিউ হিসেবে আসবে এবং প্রিন্ট হবে */
        #pdf-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: none; /* Hidden initially */
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        #pdf-template {
            width: 800px; /* A4 Width */
            background: white;
            color: black;
            padding: 50px;
            font-family: 'Times New Roman', serif;
            line-height: 1.5;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .doc-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 25px; }
        .doc-header h2 { margin: 0; font-size: 24px; text-transform: uppercase; letter-spacing: 1px; }
        
        .doc-row { margin-bottom: 8px; display: flex; }
        .doc-label { width: 150px; font-weight: bold; }
        .doc-value { flex: 1; border-bottom: 1px dotted #ccc; font-family: sans-serif; font-size: 14px; }

        .doc-body p { margin-bottom: 10px; font-size: 14px; text-align: justify; }
        .doc-body ul { margin: 10px 0 20px 20px; font-size: 14px; }
        
        /* Signature Area Fixed */
        .sign-area { display: flex; justify-content: space-between; margin-top: 60px; }
        .sign-box { width: 45%; text-align: center; }
        .sign-line { border-bottom: 1px solid #000; height: 70px; margin-bottom: 5px; position: relative; display: flex; align-items: flex-end; justify-content: center; }
        
        /* Image Style for PDF */
        .sign-img-print { 
            max-height: 60px; 
            max-width: 150px; 
            display: block; 
            margin-bottom: 5px; 
        }

        @media (max-width: 900px) { .web-container { flex-direction: column; } }
    </style>
</head>
<body>

    <div class="web-container">
        <div class="info-panel">
            <a href="index.html" class="back-arrow"><i class="fas fa-arrow-left"></i></a>
            <h1>Project<br><span>Agreement.</span></h1>
            <p>Let's make it official. Please fill out the details.</p>
            <ul class="feature-list">
                <li><i class="fas fa-check-circle"></i> Professional Service</li>
                <li><i class="fas fa-check-circle"></i> IP Rights Transfer</li>
            </ul>
        </div>

        <div class="form-panel">
            <form id="agreementForm">
                <span class="section-heading">01. Client Information</span>
                <div class="form-row">
                    <div class="form-group"><label>Full Name</label><input type="text" id="inName" class="form-input" required></div>
                    <div class="form-group"><label>Business Name</label><input type="text" id="inCompany" class="form-input"></div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;"><label>Email</label><input type="email" id="inEmail" class="form-input" required></div>

                <span class="section-heading">02. Scope</span>
                <div class="form-row">
                    <div class="form-group"><label>Service</label><select id="inService" class="form-input"><option>Logo Design</option><option>Web Design</option><option>Other</option></select></div>
                    <div class="form-group"><label>Budget</label><input type="text" id="inBudget" class="form-input"></div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;"><label>Description</label><textarea id="inDesc" class="form-input"></textarea></div>

                <span class="section-heading">03. Signature</span>
                <div class="upload-container" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" hidden accept="image/*">
                    <p>Click to Upload Signature (Image)</p>
                    <div id="filePreview" class="file-preview"><img id="previewImg" src=""></div>
                </div>

                <button type="submit" class="submit-btn" id="genBtn">Sign & Generate Official PDF</button>
            </form>
        </div>
    </div>

    <div id="pdf-overlay">
        <div id="pdf-template">
            <div class="doc-header">
                <h2>Service Agreement</h2>
                <p>Date: <span id="docDate"></span></p>
            </div>

            <div style="margin-bottom: 30px;">
                <div class="doc-row"><span class="doc-label">Provider:</span> <span class="doc-value">Arajit Halder</span></div>
                <div class="doc-row"><span class="doc-label">Client:</span> <span class="doc-value" id="outName"></span></div>
                <div class="doc-row"><span class="doc-label">Company:</span> <span class="doc-value" id="outCompany"></span></div>
                <div class="doc-row"><span class="doc-label">Email:</span> <span class="doc-value" id="outEmail"></span></div>
            </div>

            <div style="margin-bottom: 30px;">
                <div style="font-weight:bold; border-bottom:1px solid #ccc; margin-bottom:10px;">PROJECT DETAILS</div>
                <div class="doc-row"><span class="doc-label">Service:</span> <span class="doc-value" id="outService"></span></div>
                <div class="doc-row"><span class="doc-label">Budget:</span> <span class="doc-value" id="outBudget"></span></div>
                <p style="font-size:13px; margin-top:5px;"><strong>Description:</strong> <span id="outDesc"></span></p>
            </div>

            <div class="doc-body">
                <div style="font-weight:bold; border-bottom:1px solid #ccc; margin-bottom:10px;">TERMS</div>
                <p>By signing below, the Client agrees to the following:</p>
                <ul>
                    <li><strong>50% Advance Payment</strong> is required to start the project.</li>
                    <li><strong>Revisions:</strong> Includes up to 3 rounds of standard revisions.</li>
                    <li><strong>Copyrights:</strong> Full ownership is transferred to the client upon final payment.</li>
                </ul>
            </div>

            <div class="sign-area">
                <div class="sign-box">
                    <div class="sign-line"><span style="font-family:'Cursive'; font-size:18px; font-weight:bold;">Arajit.H</span></div>
                    <div>Arajit Halder<br><small>Service Provider</small></div>
                </div>
                <div class="sign-box">
                    <div class="sign-line">
                        <img id="pdfSignImg" class="sign-img-print" src="" style="display:none;"> 
                    </div>
                    <div><span id="signNameFooter">Client</span><br><small>Authorized Signature</small></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Image Upload Logic ---
        const fileInput = document.getElementById('fileInput');
        const previewImg = document.getElementById('previewImg');
        const pdfSignImg = document.getElementById('pdfSignImg');

        fileInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update Web Preview
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                    document.getElementById('dropZone').style.borderColor = '#28a745';
                    
                    // Update PDF Image Source DIRECTLY
                    pdfSignImg.src = e.target.result;
                    pdfSignImg.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        // --- Generate PDF Logic ---
        document.getElementById('agreementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('genBtn');
            const clientName = document.getElementById('inName').value;

            if(fileInput.files.length === 0) {
                alert("Please upload signature.");
                return;
            }

            // 1. Fill Data
            document.getElementById('docDate').innerText = new Date().toLocaleDateString();
            document.getElementById('outName').innerText = clientName;
            document.getElementById('outCompany').innerText = document.getElementById('inCompany').value;
            document.getElementById('outEmail').innerText = document.getElementById('inEmail').value;
            document.getElementById('outService').innerText = document.getElementById('inService').value;
            document.getElementById('outBudget').innerText = document.getElementById('inBudget').value;
            document.getElementById('outDesc').innerText = document.getElementById('inDesc').value;
            document.getElementById('signNameFooter').innerText = clientName;

            // 2. Show Overlay (Crucial for Image Rendering)
            const overlay = document.getElementById('pdf-overlay');
            const element = document.getElementById('pdf-template');
            
            overlay.style.display = 'flex'; // Make it visible so browser renders the image
            btn.innerText = "Generating PDF...";
            btn.disabled = true;

            const opt = {
                margin: 10,
                filename: `Agreement_${clientName}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // 3. Wait a moment for image to paint, then Save
            setTimeout(() => {
                html2pdf().set(opt).from(element).save().then(() => {
                    overlay.style.display = 'none'; // Hide again after saving
                    btn.innerText = "Sign & Generate Official PDF";
                    btn.disabled = false;
                });
            }, 1000); // 1 second delay ensures image is visible
        });
    </script>

</body>
</html>